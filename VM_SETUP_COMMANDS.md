# VM Setup Commands - Complete Guide

## Step 1: Verify Files Are Present

```bash
cd ~/transport/transportwebandmobile/soliflexweb

# Check if all directories exist
ls -la

# Should see:
# - backend/ (with package.json inside)
# - lib/ (Flutter source code)
# - ecosystem.config.js
# - deploy.sh
# - pubspec.yaml
```

## Step 2: Install Backend Dependencies

```bash
# Navigate to backend directory
cd backend

# Check if package.json exists
ls -la package.json

# Install dependencies
npm install --omit=dev

# Go back to root
cd ..
```

## Step 3: Build Flutter Web App

```bash
# Make sure you're in project root
cd ~/transport/transportwebandmobile/soliflexweb

# Get Flutter dependencies
flutter pub get

# Build Flutter web (this creates build/web/ directory)
flutter build web --release

# Verify build was created
ls -la build/web/
```

## Step 4: Create Logs Directory

```bash
# Create logs directory for PM2
mkdir -p logs
```

## Step 5: Stop Previous Apps (if running)

```bash
pm2 stop all
pm2 delete all
```

## Step 6: Start with PM2

```bash
# Make sure you're in project root
cd ~/transport/transportwebandmobile/soliflexweb

# Verify ecosystem.config.js exists
ls -la ecosystem.config.js

# Start apps
pm2 start ecosystem.config.js

# Save PM2 configuration
pm2 save

# Setup PM2 to start on boot
pm2 startup
# Copy and run the command that PM2 outputs (with sudo)
```

## Step 7: Verify Deployment

```bash
# Check PM2 status
pm2 list

# View logs
pm2 logs

# Test backend
curl http://localhost:3000/health

# Check if ports are listening
sudo netstat -tulpn | grep 3000
sudo netstat -tulpn | grep 4000
```

## Complete One-Liner (After git clone)

```bash
cd ~/transport/transportwebandmobile/soliflexweb && \
cd backend && npm install --omit=dev && cd .. && \
flutter pub get && \
flutter build web --release && \
mkdir -p logs && \
pm2 stop all && pm2 delete all && \
pm2 start ecosystem.config.js && \
pm2 save && \
pm2 list
```

---

## Important Notes

1. **`package.json` is in `backend/`** - Always run `npm install` from `backend/` directory
2. **`build/` folder is NOT in git** - It's ignored by `.gitignore`, must be built on VM
3. **`node_modules/` is NOT in git** - It's ignored, must be installed on VM
4. **Root `package-lock.json`** - This is leftover, can be ignored or deleted

## Files That Should Be in Git (and on VM):

✅ `backend/package.json`  
✅ `backend/server.js`  
✅ `backend/routes/`  
✅ `backend/services/`  
✅ `lib/` (all Flutter source code)  
✅ `pubspec.yaml`  
✅ `ecosystem.config.js`  
✅ `deploy.sh`  
✅ All `.md` documentation files  

## Files That Should NOT Be in Git (but generated on VM):

❌ `build/` (generated by `flutter build web`)  
❌ `backend/node_modules/` (generated by `npm install`)  
❌ `logs/` (created by PM2)  
❌ `package-lock.json` in root (if exists, can be deleted)

